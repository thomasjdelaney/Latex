\chapter{Introduction}
\label{chap:intro}
\section{Overview}
Ideas (not in order):
\begin{itemize}
    \item From small to big datasets (in terms of number of neurons)
    \item Big datasets mean statistical methods are more necessary (curse of dimensionality)
    \item Big datasets mean higher order correlations are more meaningful (schneidman)
    \item Exploit pairwise correlations in different way (eight probe)
    \item abandon correlations embrace association (COMB)
    \item electrophysiology drawbacks vs calcium benefits
    \item calcium drawbacks (fluorescence modelling) (mention nuclear filling and cell pathology) (mention that calcium imaging can only be used near the surface of the brain, e-phys can go deeper, especially with new probes)
\end{itemize}

Since Hodgkin and Huxley's squid experiments featuring a single axon \parencite{hodgkin}, to more recent research with spike sorted data from  $\sim 24000$ neurons from $34$ brain regions from $21$ mice \parencite{allen}, the number of neurons contributing to electrophysiological datasets has been growing. Recording methods using two-photon calcium imaging have also been used to extract data from populations containing over $10000$ neurons \parencite{peron}. This dramatic growth in the number of neurons to analyse required a dramatic change in analysis methods.

To focus on calcium imaging for a start, a neuron that contains a fluorescent calcium indicator in its cytoplasm will fluoresce when bombarded with photons. The amount that the cell will fluoresce is dependent on the concentration of fluorescent indicator within the cell, and the concentration of calcium within the cell. When a neuron fires an action potential, the influx of free calcium ions causes an increase in fluorescence when those ions bond with the fluorescent indicator and those bounded molecules are bombarded with photons. After the action potential, as calcium is extruded from the cell the fluorescence returns to a baseline level. This is the basic mechanism of fluorescent calcium indicator based imaging.

This method has some advantages over electrophysiology as measure of neuronal ensemble activity. Isolating individual neurons is easier and more reliable than identifying unique spike sources in electrophysiology. Also, spike sorting methods can only detect spikes, but imaging methods can also detect cells that are not spiking. Cells will emit a baseline level of fluorescence when not firing action potentials. Calcium imaging sites can be re-used for weeks for longitudinal studies \parencite{chen}. Because the fluorescent indicator is delivered to the cell by adeno-associated viruses, there can be problems with indicator gradients around the infection site, and expression levels will change in individual cells over weeks \parencite{tian, chen}. This delivery method can also cause cell pathology, and nuclear filling \parencite{zariwala}, but these problems can be solved by using lines of transgenic mice \parencite{dana}.

If the imaging data is collected at a high enough frequency, and the signal-to-noise ratio of the fluorescence trace is high enough, it should be possible to infer the spike times to some level of accuracy. For example, the calmodulin based indicator GCaMP6s has a sufficiently high signal-to-noise ratio that isolated action potentials can be detected and inferred \parencite{chen}. Many spike inference algorithms exist \parencite{vogelstein, pnevmatikakis, friedrich, paninski1, paninski2, deneux, greenberg}, and some of these can perform both cell isolation and spike detection simultaneously \parencite{vogelstein, pnevmatikakis, paninski2, deneux}. But the relationship between spiking and fluorescence change is not fully understood. For example, the fluorescent indicator will act like an additional calcium buffer within the cell cytoplasm and will compete with the other endogenous buffers to bind with free calcium cells. Therefore, the concentration of those endogenous buffers, and the binding dynamics of those buffers will have an effect on the change in fluorescence in response to an action potential. Furthermore, the binding dynamics of the fluorescent indicator itself will have an effect on the change in fluorescence. For example, the GCaMP series of fluorescence indicators are based on the calcium buffer protein \texttt{calmodulin}. This protein has four binding sites, whose affinities interact non-linearly. But most of the spike inference algorithms model the fluorescence as a linear function of a calcium trace, and they model this calcium trace as a first or second order autoregression with a pulse input to represent action potentials. Deneux et al. (2016) developed a spike inference algorithm with a bit more biological inspiration, but this amounted to a very similar process. While this autoregression idea appears to be a reasonable approximation, the algorithms that use this approximation are outperformed by the most recently published spike inference algorithm to be cited here (\parencite{greenberg}). This algorithm does take into account the binding dynamics of both the endogenous buffers and fluorescent calcium indicator, and the concentrations of free calcium, indicator, and endogenous buffer within the cell cytoplasm. This shows that there is value in more biologically inspired models of fluorescent calcium indicators.

In light of the growing populaity of two-photon calcium imaging, and the lack of biologically inspired spike inference algorithms (Greenberg et al. developed their spike inference algorithm in parallel to our work), we decided to develop a biologically inspired model for fluorescent calcium indicator fluorescence. The idea being that our model would take a spike train, or simply spike times, provided by the user, and return the fluorescence trace that would be induced by this spike train or spike times. The model contains parameters for concentrations of indicator and endogenous buffers, as well as affinity and unbinding rates for these buffers. There are also parameters for the baseline concentration of free calcium in the cell cytoplasm, and the cell radius (as a means for calculating the cell volume). With this model, we hoped that experimentalists would be able to test out different calcium indicators on the types of spike trains that they expect to encounter. This way they could decide ahead of time which indicator suited them their situation best. Since the output of our model is a fluorescence trace, the spike inference models mentioned above can be applied to the modelled fluorescence. This means that the model could also be used to benchmark the performance of these spike inference algorithms, and to investigate the impact of variations in the model on spike inference accuracy.

We have outlined some of the advantages that calcium imaging has over electrophysiology. But electrophysiology is more useful in some situations. One particular drawback for two-photon calcium imaging is that it can only be used for imaging near to the surface of the brain. Although imaging with three (or presumably more) photons may solve this problem in the future \parencite{ouzounov}. A better option for reading activity from neurons beyond the surface of the brain is to use Neuropixels probes \parencite{jun}. These probes can be used to read from thousands of neurons simultaneously in many different areas of the brain \parencite{allen, stringer, steinmetz, steinmetz2019}. This brings us to another problem for which we require new innovations in our analysis methods. Specifically, analysing correlated behaviour in neural ensembles consisting of neurons from many different brain regions.

Until the invention of new technologies such as the Neuropixels probes, most electrophysiology datasets read from neurons in only one or two regions. Therefore most of the research on interactions between neurons in different regions is limited to two regions \parencite{wierzynski, patterson, girard}. In chapters \ref{chap:eight_probe} and \ref{chap:comb} we used datasets with neurons from $9$ and $5$ different brain regions respectively.

In light of recent findings based on correlated behaviour showing that spontaneous behaviours explain activity in many different parts of the brain that would otherwise be regarded as noise \parencite{stringer}, that satiety is represented brain wide \cite{allen}, and that exploratory and non-exploratory states are represented in the amygdala \cite{grundemann}, it was clear that state representation or motor control had an influence on correlated behaviour in areas of the brain not usually associated with these tasks. Also, given differences in timescales of fluctuations in different brain regions \cite{murray}, and different timescales for event representation in different brain regions \cite{baldassano}, we decided to investigate brain wide correlated behaviour at timescales ranging from $5$ms up to $3$s.

We started off measuring the correlations in spike counts between individual neurons in our ensemble. These measurements induced a weighted undirected graph where each node represented a neuron, and the weight of each edge was the strength of the correlation between the neurons represented by the nodes at either end of that edge. In order to put the neurons into groups with correlated behaviour, we applied a novel community detection algorithm \parencite{humphries} to this graph. We repeated this analysis for timescales from milliseconds to seconds. Bear in mind that our correlation based graph was completely agnostic of the anatomical regions in which our cells resided. We then compared our correlated communities to their anatomy at each timescale. In this way, we used a novel method, never applied neuronal data before, to analyse the makeup of correlated communities across different regions at different timescales. We found that for short timescales $<50$ms correlated communities tended to exist within anatomical regions, and for longer timescales $>100$ms, the correlated communites tended to exist across anatomical regions. This is broadly in agreement with a similar finding for EEG data from humans performing semantic or memory tasks \parencite{von_stein}.

Many important findings have been made by measuring the correlations between binned spike counts, but there are some problems with this method of analysis. Firstly, the width of the bins used to bin spike times into spike counts has an effect on the magnitude of the correlations measured. Using a short bin width can cause your measurements to be artificially small \parencite{cohen2}. This may not be an issue if one is considering relative size of correlations when using the same bin width, but it is still not ideal. Secondly, while pairwise correlations can capture most of the information in a small network (up to $40$ cells) of highly correlated cells \parencite{schneidman}, a model based on pairwise correlations alone will fail to capture the activity of larger ($\sim 100$ cells) networks, higher order correlated activity is required \parencite{ganmor}. The problem with these higher order correlations is that they may be defined in different ways \parencite{staude}, and if we want to include them in a model, this usually involves greatly increasing the number of parameters to fit, leading to the `curse of dimensionality'.

bin width affects the magnitude of correlations (cohen 2)
problem with correlations is that pairwise correlations may not be sufficient for large populations (schneidman)
need to capture high order correlations
hard to define
some attempts at capturing interaction between individual cells and whole population (o donnell, okun)
for short bin widths reject correlation, embrace association
